<!doctype html>
<html>
	<head>
		<title>Template Test</title>
	    <script type="text/x-platter" id="ggt">
	      <h1>{{title}}</h1>
	      <ul>
	        <li class="before">This is before the list</li>
	        <li foreach="{{blah}}" class="{{class}} within" onclick="{{click}}">{{name}}</li>
	        <li class="after">This is after the list</li>
	      </ul>
	    </script>
		<script type="text/javascript" src="coffee-script.js"></script>
		<script type="text/coffeescript" src="platter.core.coffee"></script>
		<script type="text/coffeescript" src="platter.core.codegen.coffee"></script>
		<script type="text/coffeescript" src="platter.plain.coffee"></script>
		<script type="text/coffeescript" src="platter.dynamic.coffee"></script>
		<script type="text/coffeescript" src="platter.dynamic.backbone.coffee"></script>

		<script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
		<script type="text/javascript" src="http://documentcloud.github.com/backbone/backbone-min.js"></script>

		<script type="text/javascript">
			function goPlain(){
				var template = platter.plain.compile(document.getElementById('ggt').text);
				
				var data = {title: "This is the title", blah: []};
				for (var i=0;Math.random()*5>i;++i)
					data.blah.push({class:'row'+i, name:'Name '+Math.random(), click:function(){alert(1);}});
				
				var els = template.run(data);
				document.body.appendChild(els);
			}

			function goBackbone(){
				var template = platter.backbone.compile(document.getElementById('ggt').text);
				var data = new Backbone.Model();
				data.set({title: "This is the title"});
				data.blah = new Backbone.Collection();
				for (var i=0;Math.random()*5>i;++i) {
					var row = new Backbone.Model();
					row.set({class:'row'+i, name:'Name '+Math.random()});
					row.click=function(){alert(2);};
					data.blah.add(row);
				}
				
				var mungedata = function(){
					if (Math.random()*5>data.blah.length) {
						var row = new Backbone.Model();
						var at = Math.floor(Math.random()*(data.blah.length+1));
						row.set({class:'row'+at, name:'Name '+Math.random()});
						row.click=function(){alert(2);};
						data.blah.add(row, {at:at});
					}
					else {
						var ent = data.blah.at(Math.floor(Math.random()*data.blah.length));
						if (Math.random()>0.5)
							data.blah.remove(ent);
						else
							ent.set({name:'Name '+Math.random()})
					}
				};
				setInterval(mungedata, 1000);
				var els = template.run(data);
				document.body.appendChild(els);
			}
		</script>
	</head>
	<body>
		<button onclick="goPlain()">Plain</button>
		<button onclick="goBackbone()">Backbone</button>
	</body>
</html>
