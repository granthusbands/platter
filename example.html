<!doctype html>
<html>
	<head>
		<title>Template Test</title>
		<script type="text/x-platter" id="ggt">
			<h1 if="{{title}}">{{title}}</h1>
			<ul>
				<li class="before">This is before the list</li>
				<li foreach="{{blah}}" class="{{class.t}} within" onclick="{{click}}">{{name}}</li>
				<li class="after">This is after the list</li>
			</ul>
		</script>

		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

		<script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
		<script type="text/javascript" src="http://documentcloud.github.com/backbone/backbone-min.js"></script>
		
		<script type="text/javascript" src="platter.js"></script>

		<script type="text/javascript">
			function goPlain(){
				var template = platter.plain.compile(document.getElementById('ggt').text);
				
				var data = {title: Math.random()>0.5?"This is the title":null, blah: []};
				for (var i=0;Math.random()*5>i;++i)
					data.blah.push({class:{t:'row'+i}, name:'Name '+Math.random(), click:function(){alert(1);}});
				
				var els = template.run(data);
				document.body.appendChild(els);
			}

			function goBackbone(){
				var template = platter.backbone.compile(document.getElementById('ggt').text);
				var data = new Backbone.Model();
				data.set({title: Math.random()>0.5?"This is the title":null});
				data.blah = new Backbone.Collection();
				for (var i=0;Math.random()*5>i;++i) {
					var row = new Backbone.Model();
					row.set({class:{t:'row'+i}, name:'Name '+Math.random()});
					row.click=function(){alert(2);};
					data.blah.add(row);
				}
				
				var mungedata = function(){
					data.set({title: Math.random()>0.5?"This is the title":null});
					if (Math.random()*5>data.blah.length) {
						var row = new Backbone.Model();
						var at = Math.floor(Math.random()*(data.blah.length+1));
						row.set({class:{t:'row'+at}, name:'Name '+Math.random()});
						row.click=function(){alert(2);};
						data.blah.add(row, {at:at});
					}
					else {
						var ent = data.blah.at(Math.floor(Math.random()*data.blah.length));
						if (Math.random()>0.5)
							data.blah.remove(ent);
						else
							ent.set({name:'Name '+Math.random()})
					}
				};
				var timer = setInterval(mungedata, 1000);
				var button = document.createElement('button');
				$undo.start();
				var els = template.run(data);
				$undo.add(function(){
					document.body.removeChild(button);
					data.blah.reset();
					clearInterval(timer);
				});
				var undo = $undo.claim();
				document.body.appendChild(els);
				button.innerHTML = "Undo";
				button.onclick = undo;
				document.body.appendChild(button);
			}
		</script>
	</head>
	<body>
		<button onclick="goPlain()">Plain</button>
		<button onclick="goBackbone()">Backbone</button>
	</body>
</html>
